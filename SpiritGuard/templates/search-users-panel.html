{% load static %}
<script src="{% static '/js/jquery.min.js' %}"></script>
<link href="{% static '/css/list-of-friends.css' %}" rel="stylesheet">

<form id="search-form" method="post" action='/accounts/search_users/'>
    {% csrf_token %}
    <div class="center-content row">
        <div class="input-field col s6" style="margin:auto">
            <i class="fa fa-search prefix" style="color: white"></i>
            <input id="queryInput" type="text" name="queryInput">
            <label style="color: white" for="queryInput">Search users...</label>
        </div>
    </div>
    <div id="list-of-friends" class="center-content row">
        <div id="lof-wrapper">
            <div class="center-content row list-elem">
                <img src={% static '/gfx/avatars/default2.png' %}>
                Jacek
            </div>
            <div class="center-content row list-elem">
                <img src={% static '/gfx/avatars/default2.png' %}>
                Jacek
            </div>
            <div class="center-content row list-elem">
                <img src={% static '/gfx/avatars/default2.png' %}>
                Jacek
            </div>
            <div class="center-content row list-elem">
                <img src={% static '/gfx/avatars/default2.png' %}>
                Jacek
            </div>
            <div class="center-content row list-elem">
                <img src={% static '/gfx/avatars/default2.png' %}>
                Jacek
            </div>
            <div class="center-content row list-elem">
                <img src={% static '/gfx/avatars/default2.png' %}>
                Jacek
            </div>
        </div>
    </div>
</form>

{% block javascript %}
    <script>
        let users = [];

        function executeSearch(isValFromInputField) {
            return function () {
                $('#lof-wrapper').show();
                const nickname = isValFromInputField ? (this).val() : '';
                $.ajax({
                    url: '/ajax/users/',
                    data: {
                        'nickname': nickname
                    },
                    dataType: 'json',
                    success: function (data) {
                        users = data.users;
                        drawUsersList();
                    }
                });
            };
        }

        function drawUsersList() {
            const usersCopy = users;
            console.log(usersCopy)
        }

        function hideList() {
            $('#lof-wrapper').hide();
        }

        function onListElemClicked() {
            console.log('worken');
            event.stopPropagation();
            event.stopImmediatePropagation();
            document.location = 'http://www.google.com';
        }

        $('#queryInput').click(executeSearch(false));
        $('#queryInput').on('input', drawUsersList);
        $('.list-elem').mousedown(function (event) {
            onListElemClicked();
        });
        $('#queryInput').blur(hideList);
    </script>
{% endblock %}

